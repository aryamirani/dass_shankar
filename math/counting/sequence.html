<!DOCTYPE html>
<html>

<head>
    <title>Sequence Completion </title>
    <link rel="stylesheet" href="../../fonts.css">
    <link rel="stylesheet" href="../../english/backbutton.css">
    <link rel="stylesheet" href="../instructions.css">

    <style>
        .center-card {
            display: inline-block !important;
            width: auto !important;
            margin: 20px auto;
        }


        body {
            font-family: 'Grandstander';
            min-height: 100vh;
            background-image: url("../assets/background.png");
            background-size: cover;
        }
    </style>
</head>

<body>

    <audio id="correct-sound" src="../assets/correct.wav" preload="auto"></audio>
    <audio id="wrong-sound" src="../assets/wrong.wav" preload="auto"></audio>

    <h1 style="text-align: center; font-size: 50px;">Sequence Completion</h1>
    <div style="text-align: left;">
        <a href="countdash.html" class="card back_container" style="border-top-color: #2ecc71;">
            <span class="icon">↩️</span>
            <span class="subject-name">Back</span>
        </a>
    </div>

    <div style="text-align: center;">
        <div class="tooltip card center-card" style="font-size: 40px; z-index: 1000;">
            Instructions
            <div class="tooltiptext">
                <div class="card">
                    Welcome to Sequence Completion. Your Objective is to fill in the blanks
                    For Eg: 1 _ 3 _ 5? Ans: 1 2 3 4 5
                </div>
            </div>
        </div>
    </div>

    <div style="font-size: 50px; margin-left: 40px;">

        <div class="card" style="padding: 20px;">

            <div id="sequence" style="padding-bottom: 20px;"></div>

            <button onclick="checkAnswer()" style="font-size: 50px; border-radius: 20px;">Check Answer</button>

            <p id="result"></p>

            <div id="play-again-container">

            </div>

        </div>

    </div>

    <script>
        const correctSound = document.getElementById("correct-sound");
        const wrongSound = document.getElementById("wrong-sound");
        let answers = {}; // global
        const seqDiv = document.getElementById("sequence");
        const resultP = document.getElementById("result");
        const playAgainContainer = document.getElementById("play-again-container");

        function generateSequence() {
            seqDiv.innerHTML = ""; // clear previous sequence
            answers = {};          // reset answers

            let start = Math.floor(Math.random() * 50) + 1;
            let sequence = [];
            for (let i = 0; i < 8; i++) sequence.push(start + i);

            let gapIndices = [];
            while (gapIndices.length < 3) {
                let r = Math.floor(Math.random() * 8);
                if (!gapIndices.includes(r)) gapIndices.push(r);
            }

            sequence.forEach((num, i) => {
                if (gapIndices.includes(i)) {
                    seqDiv.innerHTML += `<input type="number" id="gap${i}" style="width:80px; font-size:40px;"> `;
                    answers[`gap${i}`] = num;
                } else {
                    seqDiv.innerHTML += num + " ";
                }
            });

            resultP.textContent = "";
            playAgainContainer.innerHTML = "";
        }

        function checkAnswer() {
            let correct = true;
            for (let id in answers) {
                let val = document.getElementById(id).value;
                if (Number(val) !== answers[id]) correct = false;
            }

            if (correct) {
                resultP.textContent = "Correct";
                playAgainContainer.innerHTML = '<button onclick="restartGame()" style="font-size: 50px; border-radius: 20px;">Play Again</button>';
                correctSound.currentTime = 0;
                correctSound.play();
            } else {
                resultP.textContent = "Try Again";
                playAgainContainer.innerHTML = "";
                wrongSound.currentTime = 0;
                wrongSound.play();

            }
        }

        function restartGame() {
            generateSequence();
        }

        generateSequence();

    </script>

</body>

</html>